OPNsense is perfect for protecting your home network, but it can cause unexpected issues
Menu
Sign in now
Close
News
PC Hardware
Submenu
CPU
GPU
Storage
Monitors
Keyboards & Mice
Software
Submenu
Productivity
Other Software
Operating Systems
Submenu
Windows
Linux
macOS
Devices
Submenu
Single-Board Computers
Laptops
Gaming Handheld
Prebuilt PC
Home
Submenu
Networking
Smart Home
Gaming
Submenu
Game Reviews
Sign in
Newsletter
Menu
Follow
Followed
Like
Threads
4
More Action
Summary
Generate a summary of this story
Sign in now
Switch 2
RTX 5060
Windows 11
Gaming
Forums
Close
OPNsense is perfect for protecting your home network, but it can cause unexpected issues
Credit:
By
Adam Conway
Published 1 day ago
I’m Adam Conway, an Irish technology fanatic with a BSc in Computer Science and I'm XDA’s Lead Technical Editor. My Bachelor’s thesis was conducted on the viability of benchmarking the non-functional elements of Android apps and smartphones such as performance, and I’ve been working in the tech industry in some way or another since 2017.
In my spare time, you’ll probably find me playing Counter-Strike or VALORANT, and you can reach out to me at adam@xda-developers.com, on Twitter as @AdamConwayIE, on Instagram as adamc.99, or u/AdamConwayIE on Reddit.
Sign in to your XDA account
Summary
Generate a summary of this story
follow
Follow
followed
Followed
Like
Like
Thread
4
Log in
Here is a fact-based summary of the story contents:
Try something different:
Show me the facts
Explain it like I’m 5
Give me a lighthearted recap
I absolutely love
OPNsense, and it's the perfect place to tinker with my home network, learn more, and do some pretty cool stuff in general. Yet every now and again, something happens that leaves me scratching my head trying to figure out what's going on. This isn't an OPNsense quirk before people tell me that I should have used pfSense instead; no, this is a security-by-default quirk, and it affects pfSense, too.
As someone who plays a lot of my
Nintendo Switch, I actually don't tend to play many online games. However, recently while trying to visit a friend's island in Animal Crossing: New Horizons, I encountered an error telling me that it couldn't connect to the other person. The error message mentioned a few different errors that it could be, and one of them mentioned NAT, otherwise known as Network Address Translation.
As it turns out, the rabbit hole I went down was, in fact, a secure implementation on the side of OPNsense and a rather puzzling choice made by Nintendo. However, it's these edge cases and weird problems that you can face which could lead someone to question what the point is in the first place. Weirdly, though, I feel more secure in my network after the experience I had in diagnosing and fixing the problem.
Why it happens (and why it's not just limited to Nintendo)
It's all down to security
Before diving into the technical cause and what exactly went wrong, this isn't a problem limited to just Nintendo. In my research, I came across PlayStation and Xbox players experiencing similar errors that were solved in the same way that this was also solved. I was first tipped off to what the problem was when I ran a connection test on the Switch, and it told me that my NAT type was D. NAT type D means that you can only connect to players with a NAT type A, though it's a Nintendo-specific notation. Many console games, including Animal Crossing, don't actually rely on the developer running a big central server for the gameplay itself. Instead, they often use peer-to-peer networking, which means your Switch has to talk directly to another person's console, and theirs has to talk back to yours. This means accepting unsolicited inbound UDP traffic at any time while connected. On most consumer routers, this happens invisibly.
UPnP is often enabled by default, and a console can poke a hole in the firewall to receive connections when it needs to. At the same time, it can also handle NAT reflection, also known as hairpin NAT. This allows a device to connect to a device on the local network using a public IP address and importantly, they take a relaxed stance on source port preservation. Many consoles, including those from Nintendo, requires that traffic outbound responds on the same port inbound as if it originated on the Switch. These conveniences are built in to most consumer routers as developers know consumers expect devices to "just work."
The flow looks something like this:
The Switch sends traffic from port 45000 and tells its peer to expect replies on 45000.
Your router, using symmetric NAT, might remap that to port 50000 on the way out, but it remembers internally that 50000 maps back to 45000.
The peer console, however, sees traffic from port 50000 when it was told to expect 45000. The mismatch causes the connection to fail.
OPNsense is different from consumer routers, as is pfSense. These come from the world of enterprise firewalls, where the default stance is security first rather than convenience. UPnP is disabled, because leaving devices free to open firewall rules on their own is a potential security nightmare. NAT reflection is not assumed either, because reflecting packets back into the LAN can cause confusing or unsafe traffic flows if you don't intend them. And OPNsense tracks connection states carefully, so if it sees traffic coming in from outside that doesn't match an established outbound session or a specific port forward, it drops it. With an enterprise firewall, these inbound peer-to-peer connections simply won't work, as they're not allowed unless you create the conditions to allow them to exist. Instead, port forwarding a range back to your Switch with NAT reflection enabled is required. Consumer routers tend to bend the rules a bit when it comes to networking, whereas enterprise firewalls will play it by the book and follow a strict "default deny" playbook. In other words, unless it's been explicitly allowed, it's getting blocked.
How to set up OPNsense for online P2P gaming
Enabling a static port
Credit:
So, if you have OPNsense and a Nintendo Switch, what can you do? Thankfully, you can create the necessary NAT rules yourself so that your Switch can access the internet and play with others as normal, and you don't need to weaken your network's security, either. All you need to do is set a static IP address for your Switch (either on-device or by reserving it in the DHCP), create a port forward for the necessary range to go back to your Switch, enable NAT reflection for the forwarded range, and then enable hybrid outbound NAT rule generation in the "outbound" settings. How do you identify the range? Well here's the other problem: Nintendo doesn't really make it easy. The company's published range to forward is 1024-65535, which is basically everything that can be assigned a port with non-root access on a Linux machine, right up until the maximum port number. There are a lot of reasons why this is a bad idea, but many users, including myself, have had success just forwarding 45000 to 65535 instead and ensuring that the Static port option is ticked.
Once I'd done this, everything worked as it should. However, coming across these quirks is often jarring, as you never really know what just worked when it really shouldn't have until you come across a situation like this. I was never aware, previously, that Nintendo was doing anything weird when it came to networking. It's not that I didn't care, it's that I just never had a reason to look into it.
This is part of why I love OPNsense, though. While it can be frustrating to face a new issue like that and not know what the cause is, it's a great feeling as well when you know that your network is secure and safe because of default settings like these. It makes you aware of what's going on when it comes to the networking side of things, and you discover what would have technically been security flaws that you never even knew about.
Networking
Follow
Followed
Like
Share
Facebook
X
LinkedIn
Reddit
Flipboard
Copy link
Email
Close
Thread
4
Sign in to your XDA account
We want to hear from you! Share your opinions in the thread below and remember to keep it respectful.
Reply / Post
Images
Attachment(s)
Please respect our community guidelines. No links, inappropriate language, or spam.
Your comment has not been saved
Send confirmation email
Sort by:
Popular
Oldest
Newest
Luke
Luke
Luke
#NP505285
Member since 2024-12-20
0
Threads
3
Posts
Following
0
Stories
0
Topics
0
Authors
0
Users
Follow
Followed
0
Followers
View
UPnP is not innately insecure, but it needs to be setup correctly to BE secure.
It's something that is often disabled on enterprise firewalls because it is typically not needed or desired in an enterprise setting.
There isn't even a default UPnP option built into OPNsense.
I am CIO for my company.
I have 6 OPNsense firewalls.
I also use OPNsense for some personal applications, though it's not my primary firewall at home.
There is a plugin that provides UPnP functionality that is available from the official repo and easily installable if your firewall is updated to the latest version.
It does require setup after installation, however, and just turning on UPnP isn't the most secure thing.
To be secure with it, you need to take the time to set it up properly.
2025-09-25 03:03:12
Upvote
1
Downvote
Reply
Copy
Proxy
Proxy
Proxy
#CV160370
Member since 2025-06-16
0
Threads
2
Posts
Following
0
Stories
0
Topics
0
Authors
0
Users
Follow
Followed
0
Followers
View
This is my biggest worry in taking this leap into changing our main to Opnsense. Like I would be taking down a network to fully setup something that would be needed but would be a huge learning curve for me. How did you set this up in terms of as little downtime for the household as possible?
2025-09-25 09:45:18
Upvote
Downvote
Reply
1
Copy
Adam
Adam
Adam
#MN479559
0
Threads
312
Posts
Following
1
Stories
0
Topics
0
Authors
0
Users
Follow
Followed
7
Followers
View
To be honest, it wasn't too bad, and this is the first "inexplicable" issue I've come across. Even then, I had it fixed within a few minutes after Googling it.I have a PPPoE connection that requires authentication with the network terminal, though there are plenty of PPPoE guides out there. I think I had everything up and running in an hour or two. The beauty of it is you can work on it over time, if it's not working how you want, just plug back in the old router again until you get time to come back to it!
2025-09-25 10:55:11
Upvote
Downvote
Reply
Copy
zdanb
zdanb
zdanb
#XH117014
Member since 2024-10-05
0
Threads
4
Posts
Following
0
Stories
0
Topics
0
Authors
0
Users
Follow
Followed
0
Followers
View
Ipfire is a good alternative
2025-09-25 11:42:48
Upvote
Downvote
Reply
Copy
Terms
Privacy
Feedback
Recommended
4 days ago
Why relying on USB-to-Ethernet adapters can cost you more in the long run
4 days ago
I built my own video platform like YouTube by self-hosting this tool
4 days ago
I let Perplexity guide my graphic design workflow, and the results were surprising
3 days ago
This awesome Raspberry Pi project brings the Game Boy Advance back to life
Today's best deals
This niche space sandbox game with 96% positive reviews is at its lowest price ever on Steam
30 minutes ago
This retro-inspired mechanical keyboard is all vibes and now just $44
4 hours ago
This rare discount makes the AMD Ryzen 7 9800X3D the ultimate CPU for your next gaming PC build
7 hours ago
See More
Trending Now
Your next Snapdragon device may help you locate stolen devices right out of the box
This self-hosted collaborative markdown editor is our family’s new wiki
4 ways I use Perplexity that have nothing to do with research
Join Our Team
Our Audience
About Us
Press & Events
Contact Us
Follow Us
Advertising
Careers
Terms
Privacy
Policies
XDA is part of the
Valnet Publishing Group
Copyright © 2025 Valnet Inc.