javascript - Three.js v133 trying to add SSAO and change renderer to composer - Stack Overflow
Skip to main content
Stack Overflow
About
Products
For Teams
Stack Overflow for Teams
Where developers & technologists share private knowledge with coworkers
Advertising
Reach devs & technologists worldwide about your product, service or employer brand
Knowledge Solutions
Data licensing offering for businesses to build and improve AI tools and models
Labs
The future of collective knowledge sharing
About the company
Visit the blog
Loading…
current community
Stack Overflow
help
chat
Meta Stack Overflow
your communities
Sign up or log in to customize your list.
more stack exchange communities
company blog
Log in
Sign up
Home
Questions
AI Assist
Labs
Tags
Challenges
Chat
Articles
Users
Jobs
Companies
Collectives
Communities for your favorite technologies.
Explore all Collectives
Teams
Ask questions, find answers and collaborate at work with Stack Overflow for Teams.
Try Teams for free
Explore Teams
Teams
Ask questions, find answers and collaborate at work with Stack Overflow for Teams.
Explore Teams
Collectives™ on Stack Overflow
Find centralized, trusted content and collaborate around the technologies you use most.
Learn more about Collectives
Teams
Q&A for work
Connect and share knowledge within a single location that is structured and easy to search.
Learn more about Teams
Three.js v133 trying to add SSAO and change renderer to composer [closed]
Ask Question
Asked
3 days ago
Modified
2 days ago
Viewed
30 times
-1
Closed. This question needs to be more focused. It is not currently accepting answers.
Want to improve this question? Guide the asker to update the question so it focuses on a single, specific problem. Narrowing the question will help others answer the question concisely. You may edit the question if you feel you can improve it yourself. If edited, the question will be reviewed and might be reopened.
Closed yesterday.
Improve this question
I'm trying to add SSAO to my three.js model, but when I change renderer.render() into composer.render() orbit control stops working and zoom of model switch to max.
one image is before adding composer and another is after
here is my init function
func.init = (set) => {
func.floorTexture = new THREE.TextureLoader().load('/images/grass.jpeg');
scissorTexture = new THREE.TextureLoader().load('/images/scissor3.png');
func.data.selector = set.div_id;
func.data.resizable = set.resizable;
func.data.boundingSphere = set.initBoundingSphere;
if (set.is_damping != undefined) func.data.is_damping = set.is_damping;
func.data.persp_cam_angle_xy = set.cam_angle[0];
func.data.persp_cam_angle_xz = set.cam_angle[1];
func.data.win_width = jQuery(`#${func.data.selector}`).width();
func.data.win_height = jQuery(`#${func.data.selector}`).height();
func.data.renderer = new THREE.WebGLRenderer({
antialias: true,
alpha: true,
logarithmicDepthBuffer: false,//true
powerPreference: 'high-performance',
precision: 'highp',
});
func.data.autoClear = true;//true
func.data.renderer.setPixelRatio(window.devicePixelRatio);
func.data.renderer.physicallyCorrectLights = true;
func.data.renderer.outputEncoding = THREE.sRGBEncoding;
func.data.renderer.sortObjects = true;
func.data.renderer.shadowMap.enabled = true;
func.data.renderer.shadowMap.type = THREE.PCFSoftShadowMap; //
func.data.renderer.shadowMap.autoUpdate = false;
func.data.renderer.setSize(func.data.win_width, func.data.win_height);
func.data.renderer.domElement.classList.add(`${func.data.selector}-visualizer`);
//
let canvasContainer = document.getElementById(func.data.selector);
if (canvasContainer.querySelector(`.${func.data.selector}-visualizer`)) {
canvasContainer.querySelector(`.${func.data.selector}-visualizer`).remove();
}
document.getElementById(func.data.selector).appendChild(func.data.renderer.domElement);
func.data.scene = new THREE.Scene();
func.ambientLight = new THREE.AmbientLight(0xffffff, 1.5);//3
func.data.scene.add(func.ambientLight);
func.data.renderer.setClearColor(set.background_color[0], set.background_color[1]);
if (set.light_type[0] == "HemisphereLight") {
let hemiSphere = new THREE.HemisphereLight(set.light_type[1], set.light_type[2], set.light_type[3]);
}
else if (set.light_type[0] == "AmbientLight") {
let ambientLight = new THREE.AmbientLight(set.light_type[1], set.light_type[2]);
}
if (func.data.renderer.domElement.classList.contains(`${func.data.selector}-visualizer`) && !func.data.renderer.domElement.classList.contains('three-win-axis-visualizer') && !func.data.renderer.domElement.classList.contains('three-win-side-axis-visualizer') && typeof ThreePerf == 'function') {
func.perf = new ThreePerf({
showGraph: true,
anchorX: 'right',
anchorY: 'top',
domElement: $(`#${func.data.selector}`).get(0), // or other canvas rendering wrapper
renderer: func.data.renderer, // three js renderer instance you use for rendering
scale: 1,
guiVisible: false,
actionToCallUI: "gui"
});
var isPerfVisiblity = localStorage.getItem(`${func.data.selector}-PerfomanceTableVisible`);
if (isPerfVisiblity != 'false' && isPerfVisiblity != null)
$(`#${func.data.selector}`).find('#three-perf-ui').removeClass('d-none');
else
$(`#${func.data.selector}`).find('#three-perf-ui').addClass('d-none');
}
func.data.camera = createPerspectiveCamera()
func.data.controls = new THREE.OrbitControls(func.data.camera, func.data.renderer.domElement);
// 1. Creating EffectComposer іand save it in func.data
func.data.composer = new THREE.EffectComposer(func.data.renderer);
func.data.composer.setSize(func.data.win_width, func.data.win_height);
// 2. Add RenderPass (main scene render)
const renderPass = new THREE.RenderPass(func.data.scene, func.data.camera);
//renderPass.clear = true;
func.data.composer.addPass(renderPass);
// 3. Create and setup SSAOPass
const ssaoPass = new THREE.SSAOPass(
func.data.scene,
func.data.camera,
func.data.win_width,
func.data.win_height
);
ssaoPass.kernelRadius = 10;
// Effect raduis. Try values from 8 to 32
ssaoPass.minDistance = 0.005;
// Min distance for effect
ssaoPass.maxDistance = 0.1;
// Max distance
func.data.composer.addPass(ssaoPass);
//// 4. Add GammaCorrection for right visibility of colors
const gammaPass = new THREE.ShaderPass(THREE.GammaCorrectionShader);
//gammaPass.clear = false;
gammaPass.renderToScreen = true;
func.data.composer.addPass(gammaPass);
//var copyPass = new THREE.ShaderPass(THREE.CopyShader);
//copyPass.renderToScreen = true;
//func.data.composer.addPass(copyPass);
// --- End implement SSAO ---
func.addOrbitEvents(func.data.controls);
if (func.data.is_damping) func.controlDamping();
func.data.controls.addEventListener('change', requestRenderIfNotRequested);
if (!set.is_isometric) func.initPerspectiveCamera('ortho');
else func.initIsometricCamera('ortho');
if (func.data.resizable) {
window.addEventListener('resize', func.onWindowResize);
window.addEventListener('resize', func.controlFunc);
}
boundingBoxConst = func.data.boundingSphere.radius;
};
and here is my render function
function requestRenderIfNotRequested() {
if (!func.data.renderRequested) {
func.data.renderRequested = true;
requestAnimationFrame(render);
}
};
function render() {
//requestAnimationFrame(render);
func.data.renderRequested = false;
if (func.data.timeout !== null) clearTimeout(func.data.timeout);
func.data.timeout = setTimeout(function () {
func.controlFuncEnd();
}, 100);
//func.data.controls.update();
// Check if controls zoomIn/Out
let controls = func.data.controls;
let camera = func.data.camera;
let lastZoom = camera.zoom;
let newDistance = camera.position.distanceTo(controls.target);
let epsilon = 0.0001;
func.isZoomingIn = false;
func.isZoomingOut = false;
if (camera.isPerspectiveCamera) {
if (Math.abs(newDistance - lastDistance) > epsilon && visualizer) {
func.isZoomingIn = newDistance < lastDistance;
func.isZoomingOut = newDistance > lastDistance;
}
lastDistance = newDistance;
}
if (camera.isOrthographicCamera) {
if (Math.abs(camera.zoom - lastZoom) > epsilon && visualizer) {
func.isZoomingIn = camera.zoom > lastZoom;
func.isZoomingOut = camera.zoom < lastZoom;
}
lastZoom = camera.zoom;
}
func.isZoomingInOut = func.isZoomingIn || func.isZoomingOut;
func.data.controls.update();
if (clippingMovePlaneState && clippingMovePlaneState()) {
func.updateClippingPlane();
updateLableSizes();
}
if (func.data.renderer.domElement.classList.contains(`${func.data.selector}-visualizer`) && !func.data.renderer.domElement.classList.contains('three-win-axis-visualizer') && !func.data.renderer.domElement.classList.contains('three-win-side-axis-visualizer') && typeof ThreePerf == 'function')
func.perf.begin();
//func.data.renderer.render(func.data.scene, func.data.camera);
//if (func.data.composer) {
func.data.composer.render();
//} else {
//
//if composer is not initted
//
func.data.renderer.render(func.data.scene, func.data.camera);
//}
if (func.data.renderer.domElement.classList.contains(`${func.data.selector}-visualizer`) && !func.data.renderer.domElement.classList.contains('three-win-axis-visualizer') && !func.data.renderer.domElement.classList.contains('three-win-side-axis-visualizer') && typeof ThreePerf == 'function')
func.perf.end();
func.controlFunc();
func.controlFuncStart();
if (visualizer && (visualizer.toolIsActive('pick') || visualizer.toolIsActive('measure') || (visualizer.positionAssemblyManager && visualizer.positionAssemblyManager.mode == 'order')) && !func.data.isRotating) {
if (func.isZoomingInOut) return;
func.controlFuncEnd();
}
};
I've also gismo cube that uses this function to init to and removed it, it want helped.
I also tried to add renderToScreen to the last pass of composer. Nothing helped me!
javascriptthree.jsmeshssao
Share
Improve this question
Follow
edited 2 days ago
TylerH
21.2k8383 gold badges8383 silver badges120120 bronze badges
asked Sep 17 at 17:09
Евгений КреничныйЕвгений Креничный
1
Add a comment
|
Related questions
1246
How do you remove all the options of a select box and then add one option and select it with jQuery?
0
Three.js and ssao
714
jQuery checkbox change and click event
Related questions
1246
How do you remove all the options of a select box and then add one option and select it with jQuery?
0
Three.js and ssao
714
jQuery checkbox change and click event
2
Artefacts with SSAO in Three.js only on MacBook Pro (Retina)
0
Three.js - SSAO defect transparent area
1
Rendering multiple scenes, with only 1 using SSAO [Three.js]
0
Three.js SSAO on a smooth mesh produces flat-shaded results
Load 4 more related questions
Show fewer related questions
0
Sorted by:
Reset to default
Highest score (default)
Trending (recent votes count more)
Date modified (newest first)
Date created (oldest first)
Start asking to get answers
Find the answer to your question by asking.
Ask question
Explore related questions
javascriptthree.jsmeshssao
See similar questions with these tags.
The Overflow Blog
Stack Overflow is helping you learn to code with new resources
Off with your CMS’s head! Composability and security in headless CMS
Featured on Meta
Spevacus has joined us as a Community Manager
Introducing a new proactive anti-spam measure
New comment UI experiment graduation
New and improved coding challenges
Policy: Generative AI (e.g., ChatGPT) is banned
Hot Network Questions
Linear rheostat - where lies a trick of a sliding contact with isolated wire?
How does boss dialogue change if fought at max level?
git says Bad key types '+ssh-rsa,ssh-dss' when trying to do git fetch on my MacBook. How do I fix?
A man you don't meet every day
PCIe to SGMII/RGMII for Automotive Ethernet card
Clarification of "Trautes Heim, Glück allein"
Update docker service volume
Weep holes or other? Should they be filled?
What's that 90s short-story? A magazine guess-how-many-objects-fit contest, a computer calculation bug, and prize money delivered as gold
why is it impossible to find onto map S to its power set?
If a partition that has always been able to be mounted normally,suddenly cannot be mounted and enters Emergency Mode,what might be the reason?
Transitioning a file encryption application to Post Quantum Cryptography
Interpretation of slope coefficient when a variable appears in multiple powers
When was God featured in The Simpsons?
Analyzing test result using test statistic vs p-value?
How to directly reboot into the EFI GUI via an EFI shell?
Short story. Couple transfer the consciousness of their dead daughter into the brain of an ape
Maximizing profit given a PMF
What was the first video game to feature a fake credits sequence?
Two definitions of regularity for ultrafilters
Is there a substance that passes through gasses, but reacts violently (explosive) when confronted with solid matter?
Implementation of a kd-tree header-only library
Prospective new PI wants to chat with former PI who kicked me out. What to do?
How should we understand **God is Just** in relation to him killing Davids child due to his sins?
more hot questions
lang-js
Stack Overflow
Questions
Help
Chat
Products
Teams
Advertising
Talent
Company
About
Press
Work Here
Legal
Privacy Policy
Terms of Service
Contact Us
Your Privacy Choices
Cookie Policy
Stack Exchange Network
Technology
Culture & recreation
Life & arts
Science
Professional
Business
API
Data
Blog
Facebook
Twitter
LinkedIn
Instagram
Site design / logo © 2025 Stack Exchange Inc;
user contributions licensed under
CC BY-SA
.
rev 2025.9.19.34211