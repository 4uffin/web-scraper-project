change ssh port script · GitHub
Skip to content
Search Gists
Search Gists
All gists
Back to GitHub
Sign in
Sign up
Sign in
Sign up
You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.
Dismiss alert
Instantly share code, notes, and snippets.
iraj-zahedi/gist:d13f298071df8bcd2586f8482f132f16
Last active
September 23, 2025 13:51
Show Gist options
Download ZIP
Star
1
(1)
You must be signed in to star a gist
Fork
0
(0)
You must be signed in to fork a gist
Embed
Embed
Embed this gist in your website.
Share
Copy sharable link for this gist.
Clone via HTTPS
Clone using the web URL.
Learn more about clone URLs
Clone this repository at &lt;script src=&quot;https://gist.github.com/iraj-zahedi/d13f298071df8bcd2586f8482f132f16.js&quot;&gt;&lt;/script&gt;
Save iraj-zahedi/d13f298071df8bcd2586f8482f132f16 to your computer and use it in GitHub Desktop.
Code
Revisions
5
Stars
1
Embed
Embed
Embed this gist in your website.
Share
Copy sharable link for this gist.
Clone via HTTPS
Clone using the web URL.
Learn more about clone URLs
Clone this repository at &lt;script src=&quot;https://gist.github.com/iraj-zahedi/d13f298071df8bcd2586f8482f132f16.js&quot;&gt;&lt;/script&gt;
Save iraj-zahedi/d13f298071df8bcd2586f8482f132f16 to your computer and use it in GitHub Desktop.
Download ZIP
change ssh port script
Raw
gistfile1.txt
#!/bin/bash
# Universal SSH port changer for systemd-based Linux (Ubuntu 22/24, Debian, AlmaLinux/RHEL/CentOS)
# --- Ensure the script is run as root ---
if [ "$EUID" -ne 0 ]; then
echo "Please run this script as root."
exit 1
fi
# --- Prompt user for the new port ---
echo ""
echo -n "Please enter the new SSH port: "
while read SSHPORT; do
if [[ "$SSHPORT" =~ ^[0-9]+$ && "$SSHPORT" -ge 1024 && "$SSHPORT" -le 65535 ]]; then
break
else
echo -e "Invalid port: must be a number between 1024 and 65535."
echo -n "Please enter the new SSH port: "
fi
done
# --- Backup and Modify SSH Configuration ---
echo "Backing up /etc/ssh/sshd_config..."
NOW=$(date +"%Y-%m-%d_%H-%M-%S")
cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup.$NOW
echo "Changing port to $SSHPORT in /etc/ssh/sshd_config..."
sed -i '/^#\?Port/d' /etc/ssh/sshd_config
echo "Port $SSHPORT" >> /etc/ssh/sshd_config
sleep 1
# --- Firewall Management ---
if command -v ufw &> /dev/null; then
echo "UFW detected. Adding rule for port $SSHPORT..."
ufw allow $SSHPORT/tcp
echo "UFW rule updated."
elif command -v firewall-cmd &> /dev/null; then
echo "Firewalld detected. Adding port $SSHPORT..."
firewall-cmd --permanent --add-port=${SSHPORT}/tcp
firewall-cmd --reload
echo "Firewalld rule updated."
else
echo "Warning: No known firewall detected. Configure manually to allow port $SSHPORT."
fi
# --- SELinux Management (RHEL/AlmaLinux) ---
if command -v semanage &> /dev/null; then
echo "SELinux detected. Applying port context..."
semanage port -a -t sshd_port_t -p tcp $SSHPORT 2>/dev/null || \
semanage port -m -t sshd_port_t -p tcp $SSHPORT
echo "SELinux policy updated for port $SSHPORT."
fi
# --- Restart SSH Service (Universal fix) ---
echo "Restarting SSH service..."
# Handle Ubuntu socket activation
if systemctl list-unit-files | grep -q "^ssh.socket"; then
echo "Detected ssh.socket → disabling it and restarting ssh.service..."
systemctl disable --now ssh.socket
fi
# Restart the appropriate service
if systemctl list-unit-files | grep -q "^ssh.service"; then
systemctl restart ssh.service
elif systemctl list-unit-files | grep -q "^sshd.service"; then
systemctl restart sshd.service
else
echo "ERROR: Could not detect ssh/sshd service name. Please restart manually."
exit 1
fi
echo ""
echo "----------------------------------------------------------------"
echo "SUCCESS!"
echo "The SSH port has been changed to: $SSHPORT"
echo ""
echo "IMPORTANT: Open a NEW terminal and test logging in with the new port BEFORE closing this session."
echo "Example: ssh your_user@your_server_ip -p $SSHPORT"
echo "----------------------------------------------------------------"
echo ""
exit 0
Comments are disabled for this gist.
Footer
© 2025 GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
Community
Docs
Contact
Manage cookies
Do not share my personal information
You can’t perform that action at this time.