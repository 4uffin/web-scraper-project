üíé ANN: oauth2 v2.0.16 w/ full E2E example (& Instagram Compat) - DEV Community
Forem Feed
Follow new Subforems to improve your feed
DEV Community
Follow
A space to discuss and keep up software development and manage your software career
Gamers Forem
Follow
An inclusive community for gaming enthusiasts
Future
Follow
News and discussion of science and technology such as AI, VR, cryptocurrency, quantum computing, and more.
Music Forem
Follow
From composing and gigging to gear, hot music takes, and everything in between.
DUMB DEV Community
Follow
Memes and software development shitposting
Vibe Coding Forem
Follow
Discussing AI software development, and showing off what we're building.
Popcorn Movies and TV
Follow
Movie and TV enthusiasm, criticism and everything in-between.
Design Community
Follow
Web design, graphic design and everything in-between
Maker Forem
Follow
A community for makers, hobbyists, and professionals to discuss Arduino, Raspberry Pi, 3D printing, and much more.
Scale Forem
Follow
For engineers building software at scale. We discuss architecture, cloud-native, and SRE‚Äîthe hard-won lessons you can't just Google
Forem Core
Follow
Discussing the core forem open source software project ‚Äî features, bugs, performance, self-hosting.
Security Forem
Follow
Your central hub for all things security. From ethical hacking and CTFs to GRC and career development, for beginners and pros alike
Crypto Forem
Follow
A collaborative community for all things Crypto‚Äîfrom Bitcoin to protocol development and DeFi to NFTs and market analysis.
Open Forem
Follow
A general discussion space for the Forem community. If it doesn't have a home elsewhere, it belongs here
Dropdown menu
Dropdown menu
Skip to content
Navigation menu
Search
Powered by Algolia
Search
Log in
Create account
DEV Community
Close
Add reaction
Like
Unicorn
Exploding Head
Raised Hands
Fire
Jump to Comments
Save
Boost
More...
Moderate
Copy link
Copy link
Copied to Clipboard
Share to X
Share to LinkedIn
Share to Facebook
Share to Mastodon
Report Abuse
Peter H. Boling
Posted on Sep 14
‚Ä¢ Edited on Sep 16
üíé ANN: oauth2 v2.0.16 w/ full E2E example (& Instagram Compat)
#docker
#security
#ruby
#instagram
Actually Instagram compatibility came in oauth2 v2.0.15, but I didn't make a separate post about it. So here's what you need to know:
verb-dependent token transmission mode for AccessToken makes it Instagram compatible.
Complete example included!
OK, now on with v2.0.16!
Complete E2E single file script
runs against navikt/mock-oauth2-server
E2E script in source
NOTE: The mock test server was added to source in oauth v2.0.11, and has now been upgraded to the latest version of mock-oauth2-server. The mock test server is not in the packaged gem.
docker compose -f docker-compose-ssl.yml up -d --wait
ruby examples/e2e.rb
# If your machine is slow or Docker pulls are cold, increase the wait:
E2E_WAIT_TIMEOUT=120 ruby examples/e2e.rb
# The mock server serves HTTP on 8080; the example points to http://localhost:8080 by default.
Enter fullscreen mode
Exit fullscreen mode
The output should be something like this:
‚ûú
ruby examples/e2e.rb
Access token (truncated): eyJraWQiOiJkZWZhdWx0...
userinfo status: 200
userinfo body: {"sub" => "demo-sub", "aud" => ["demo-aud"], "nbf" => 1757816758000, "iss" => "http://localhost:8080/default", "exp" => 1757820358000, "iat" => 1757816758000, "jti" => "d63b97a7-ebe5-4dea-93e6-d542caba6104"}
E2E complete
Enter fullscreen mode
Exit fullscreen mode
Make sure to shut down the mock server when you are done:
docker compose -f docker-compose-ssl.yml down
Enter fullscreen mode
Exit fullscreen mode
Troubleshooting: validate connectivity to the mock server
Check container status and port mapping:
docker compose -f docker-compose-ssl.yml ps
From the host, try the discovery URL directly (this is what the example uses by default):
curl -v http://localhost:8080/default/.well-known/openid-configuration
If that fails immediately, also try: curl -v --connect-timeout 2 http://127.0.0.1:8080/default/.well-known/openid-configuration
From inside the container (to distinguish container vs host networking):
docker exec -it oauth2-mock-oauth2-server-1 curl -v http://127.0.0.1:8080/default/.well-known/openid-configuration
Simple TCP probe from the host:
nc -vz localhost 8080
# or: ruby -rsocket -e 'TCPSocket.new("localhost",8080).close; puts "tcp ok"'
Inspect which host port 8080 is bound to (should be 8080):
docker inspect -f '{{ (index (index .NetworkSettings.Ports "8080/tcp") 0).HostPort }}' oauth2-mock-oauth2-server-1
Look at server logs for readiness/errors:
docker logs -n 200 oauth2-mock-oauth2-server-1
On Linux, ensure nothing else is bound to 8080 and that firewall/SELinux aren‚Äôt blocking:
ss -ltnp | grep :8080
Notes
Discovery URL pattern is: http://localhost:8080//.well-known/openid-configuration, where
defaults to "default".
You can change these with env vars when running the example:
E2E_ISSUER_BASE (default: http://localhost:8080)
E2E_REALM (default: default)
See the full changelogs after a word from (or is it for?) my sponsor (you!).
Support & Funding Info
I am a full-time FLOSS maintainer. If you find my work valuable I ask that you become a sponsor. Every dollar helps!
ü•∞ Support FLOSS work ü•∞
Get access
"Sponsors" channel
on Galtzo FLOSS
Discord üëáÔ∏è
2.0.16 - 2025-09-14
TAG: v2.0.16
COVERAGE: 100.00% -- 520/520 lines in 14 files
BRANCH COVERAGE: 100.00% -- 176/176 branches in 14 files
90.48% documented
Added
gh!680 - E2E example using mock test server added in v2.0.11 by @pboling
mock-oauth2-server upgraded to v2.3.0
https://github.com/navikt/mock-oauth2-server
docker compose -f docker-compose-ssl.yml up -d --wait
ruby examples/e2e.rb
docker compose -f docker-compose-ssl.yml down
mock server readiness wait is 90s
override via E2E_WAIT_TIMEOUT
gh!676, gh!679 - Apache SkyWalking Eyes dependency license check by @pboling
Changed
gh!678 - Many improvements to make CI more resilient (past/future proof) by @pboling
gh!681 - Upgrade to kettle-dev v1.1.19
2.0.15 - 2025-09-08
TAG: v2.0.15
COVERAGE: 100.00% -- 519/519 lines in 14 files
BRANCH COVERAGE: 100.00% -- 174/174 branches in 14 files
90.48% documented
Added
gh!671 - Complete documentation example for Instagram by @pboling
.env.local.example for contributor happiness
note lack of builds for JRuby 9.2, 9.3 & Truffleruby 22.3, 23.0
actions/runner - issues/2347
community/discussions/15452
gh!670 - AccessToken: verb-dependent token transmission mode by @mrj
e.g., Instagram GET=:query, POST/DELETE=:header
Changed
gh!669 - Upgrade to kettle-dev v1.1.9 by @pboling
Fixed
Remove accidentally duplicated lines, and fix typos in CHANGELOG.md
point badge to the correct workflow for Ruby 2.3 (caboose.yml)
Photo (cropped) by Zoha Gohar on Unsplash
Top comments (0)
Subscribe
Personal
Trusted User
Create template
Templates let you quickly answer FAQs or store snippets for re-use.
Submit
Preview
Dismiss
Code of Conduct
‚Ä¢
Report abuse
Are you sure you want to hide this comment? It will become hidden in your post, but will still be visible via the comment's permalink.
Hide child comments as well
Confirm
For further actions, you may consider blocking this person and/or reporting abuse
Peter H. Boling
Follow
AI is my Sidekiq. Human of Earth, maker of code, director, team leader, mentor, linux system admin, FLOSS advocate, barista, student, and builder of web applications great and small for 25 years.
Location
Detroi, MI
Education
Ball State University, Purdue University
Pronouns
he/him/his
Work
You should hire me
Joined
Jan 17, 2021
More from Peter H. Boling
üíé ANN: kettle-dev v1.1.20 w/ improved CHANGELOG handling
#devtools
#ruby
#packaging
#automation
üíé ANN: oauth2 v2.0.13
#webdev
#ruby
#oauth
#opensource
üíé ANN: stone_checksums v1.0.2
#programming
#ruby
#rubygems
#security
üíé DEV Diamond Sponsors
Thank you to our Diamond Sponsors for supporting the DEV Community
Google AI is the official AI Model and Platform Partner of DEV
Neon is the official database partner of DEV
Algolia is the official search partner of DEV
DEV Community ‚Äî A space to discuss and keep up software development and manage your software career
Home
DEV++
Podcasts
Videos
Tags
DEV Education Tracks
DEV Challenges
DEV Help
Advertise on DEV
DEV Showcase
About
Contact
Free Postgres Database
Software comparisons
Forem Shop
Code of Conduct
Privacy Policy
Terms of Use
Built on Forem ‚Äî the open source software that powers DEV and other inclusive communities.
Made with love and Ruby on Rails. DEV Community ¬© 2016 - 2025.
We're a place where coders share, stay up-to-date and grow their careers.
Log in
Create account