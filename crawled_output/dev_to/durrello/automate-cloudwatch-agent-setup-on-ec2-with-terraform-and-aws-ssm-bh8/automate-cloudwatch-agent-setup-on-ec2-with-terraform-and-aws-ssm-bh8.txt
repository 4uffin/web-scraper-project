Automate CloudWatch Agent Setup on EC2 with Terraform and AWS SSM - DEV Community
Forem Feed
Follow new Subforems to improve your feed
DEV Community
Follow
A space to discuss and keep up software development and manage your software career
Gamers Forem
Follow
An inclusive community for gaming enthusiasts
Future
Follow
News and discussion of science and technology such as AI, VR, cryptocurrency, quantum computing, and more.
Music Forem
Follow
From composing and gigging to gear, hot music takes, and everything in between.
DUMB DEV Community
Follow
Memes and software development shitposting
Vibe Coding Forem
Follow
Discussing AI software development, and showing off what we're building.
Popcorn Movies and TV
Follow
Movie and TV enthusiasm, criticism and everything in-between.
Design Community
Follow
Web design, graphic design and everything in-between
Maker Forem
Follow
A community for makers, hobbyists, and professionals to discuss Arduino, Raspberry Pi, 3D printing, and much more.
Scale Forem
Follow
For engineers building software at scale. We discuss architecture, cloud-native, and SREâ€”the hard-won lessons you can't just Google
Forem Core
Follow
Discussing the core forem open source software project â€” features, bugs, performance, self-hosting.
Security Forem
Follow
Your central hub for all things security. From ethical hacking and CTFs to GRC and career development, for beginners and pros alike
Open Forem
Follow
A general discussion space for the Forem community. If it doesn't have a home elsewhere, it belongs here
Crypto Forem
Follow
A collaborative community for all things Cryptoâ€”from Bitcoin to protocol development and DeFi to NFTs and market analysis.
Dropdown menu
Dropdown menu
Skip to content
Navigation menu
Search
Powered by Algolia
Search
Log in
Create account
DEV Community
Close
Add reaction
Like
Unicorn
Exploding Head
Raised Hands
Fire
Jump to Comments
Save
Boost
More...
Moderate
Copy link
Copy link
Copied to Clipboard
Share to X
Share to LinkedIn
Share to Facebook
Share to Mastodon
Report Abuse
Durrell
Gemuh
Posted on Sep 18
Automate CloudWatch Agent Setup on EC2 with Terraform and AWS SSM
#aws
#terraform
#ssm
#devops
Automate CloudWatch Agent Setup on EC2 with Terraform and AWS SSM
Managing monitoring agents across EC2 instances can be challenging, but AWS Systems Manager (SSM) simplifies this with seamless automation. This post demonstrates how to use Terraform to deploy the CloudWatch Agent automatically to EC2 instances tagged for monitoring with both Linux and Windows configurations.
This Terraform configuration sets up AWS Systems Manager (SSM) to automatically install and configure the CloudWatch Agent on EC2 instances tagged for monitoring, supporting both Linux and Windows. It includes IAM roles, SSM parameters, CloudWatch log groups, an S3 bucket for logs, CloudWatch dashboards, and SSM associations for automation.
Key Components in the Terraform Configuration
IAM Role and Instance Profile
Creates an IAM role with permissions for EC2 to use SSM and CloudWatch and attaches the AmazonSSMManagedInstanceCore and CloudWatchAgentServerPolicy AWS managed policies. An instance profile is created for EC2 instances to assume this role.
CloudWatch Log Groups
Separate log groups for Linux (/aws/ec2/var/log/messages) and Windows (/aws/ec2/windows/logs) with 14-day retention. These are used to collect logs from the monitored instances.
SSM Parameters for CloudWatch Agent Configuration
Stores JSON configurations for the CloudWatch agent. Linux and Windows use different parameters specifying metrics to collect like CPU, memory, disk, network, and system events, adhering to best practices and AWS guidelines.
S3 Bucket for SSM Logs
A versioned and encrypted S3 bucket with lifecycle rules to store and manage logs from SSM associations, ensuring logs are kept secure and cleaned up after 30 days.
CloudWatch Dashboard
A dashboard showing CPU, memory, and disk usage metrics for EC2 instances monitored by the CloudWatch agent, aiding in quick health visualization.
SSM Associations
Three associations automate CloudWatch Agent installation and configuration:
install_cloudwatch_agent: Installs the agent on EC2 instances tagged cloudwatch=enabled.
configure_cloudwatch_agent_linux: Uses the Linux configuration parameter to configure the agent on Linux instances.
configure_cloudwatch_agent_windows: Uses the Windows configuration parameter to configure the agent on Windows instances.
How to Use This Setup
Tag your EC2 instances with cloudwatch=enabled and os=Linux or os=Windows.
This ensures only targeted instances receive the CloudWatch agent installation and configuration.
Attach the IAM instance profile produced by this Terraform to your EC2 instances. For example:
iam_instance_profile_name output contains the profile name to use.
Deploy the Terraform configuration. This will create all the resources, including IAM roles, log groups, SSM parameters, S3 bucket, dashboards, and associations.
SSM will run the associations on schedule (every 30â€“40 minutes) ensuring the CloudWatch agent is installed and configured automatically.
Monitor using the CloudWatch dashboard created to visualize key metrics.
Benefits of this Approach
Automated setup and configuration without manual intervention on each instance.
Centralized management of monitoring configurations via SSM parameters.
Cost-effective log management with lifecycle policies on S3.
Support for both Linux and Windows instances with tailored metric collection.
Easy scaling by tagging more instances.
GitHub Repository
This Terraform code is pushed and maintained in a GitHub repository for easy access and version control. You can clone, customize, or contribute enhancements as needed.
Top comments (0)
Subscribe
Personal
Trusted User
Create template
Templates let you quickly answer FAQs or store snippets for re-use.
Submit
Preview
Dismiss
Code of Conduct
â€¢
Report abuse
Are you sure you want to hide this comment? It will become hidden in your post, but will still be visible via the comment's permalink.
Hide child comments as well
Confirm
For further actions, you may consider blocking this person and/or reporting abuse
Durrell
Gemuh
Follow
Location
Buea, Cameroon
Work
Founder @ NextGen Playground
Joined
Aug 20, 2025
More from Durrell
Gemuh
Accessing HashiCorp Vault UI in Kubernetes with LoadBalancer Service
#kubernetes
#vault
#linux
#devops
Deploying and Managing HashiCorp Vault in Kubernetes with HA and Raft Storage
#kubernetes
#vault
#devops
#linux
Master Your Workflow with GitFlow: A Branching Strategy for Seamless Development
#git
#devops
#linux
#github
ðŸ’Ž DEV Diamond Sponsors
Thank you to our Diamond Sponsors for supporting the DEV Community
Google AI is the official AI Model and Platform Partner of DEV
Neon is the official database partner of DEV
Algolia is the official search partner of DEV
DEV Community â€” A space to discuss and keep up software development and manage your software career
PÃ¡gina Inicial
DEV++
Welcome Thread
Podcasts
Videos
Tags
DEV Education Tracks
DEV Challenges
DEV Help
Advertise on DEV
DEV Showcase
Sobre
Contato
Free Postgres Database
Software comparisons
Forem Shop
CÃ³digo de Conduta
PolÃ­tica de Privacidade
Termos de Uso
Built on Forem â€” the open source software that powers DEV and other inclusive communities.
Made with love and Ruby on Rails. DEV Community Â© 2016 - 2025.
We're a place where coders share, stay up-to-date and grow their careers.
Log in
Create account