Crie um Laborat√≥rio SonarQube com Vagrant: Do Zero - DEV Community
Forem Feed
Follow new Subforems to improve your feed
DEV Community
Follow
A space to discuss and keep up software development and manage your software career
Gamers Forem
Follow
An inclusive community for gaming enthusiasts
Future
Follow
News and discussion of science and technology such as AI, VR, cryptocurrency, quantum computing, and more.
Music Forem
Follow
From composing and gigging to gear, hot music takes, and everything in between.
DUMB DEV Community
Follow
Memes and software development shitposting
Vibe Coding Forem
Follow
Discussing AI software development, and showing off what we're building.
Popcorn Movies and TV
Follow
Movie and TV enthusiasm, criticism and everything in-between.
Design Community
Follow
Web design, graphic design and everything in-between
Maker Forem
Follow
A community for makers, hobbyists, and professionals to discuss Arduino, Raspberry Pi, 3D printing, and much more.
Scale Forem
Follow
For engineers building software at scale. We discuss architecture, cloud-native, and SRE‚Äîthe hard-won lessons you can't just Google
Forem Core
Follow
Discussing the core forem open source software project ‚Äî features, bugs, performance, self-hosting.
Security Forem
Follow
Your central hub for all things security. From ethical hacking and CTFs to GRC and career development, for beginners and pros alike
Open Forem
Follow
A general discussion space for the Forem community. If it doesn't have a home elsewhere, it belongs here
Crypto Forem
Follow
A collaborative community for all things Crypto‚Äîfrom Bitcoin to protocol development and DeFi to NFTs and market analysis.
Dropdown menu
Dropdown menu
Skip to content
Navigation menu
Search
Powered by Algolia
Search
Log in
Create account
DEV Community
Close
Add reaction
Like
Unicorn
Exploding Head
Raised Hands
Fire
Jump to Comments
Save
Boost
More...
Moderate
Copy link
Copy link
Copied to Clipboard
Share to X
Share to LinkedIn
Share to Facebook
Share to Mastodon
Report Abuse
Marcos Vilela
Posted on Sep 17
Crie um Laborat√≥rio SonarQube com Vagrant: Do Zero
#braziliandevs
#devops
#sonarqube
#coding
Voc√™ j√° precisou testar o SonarQube, j√° teve curiosidade, mas n√£o queria instalar um ambiente Java completo ou bagun√ßar seu sistema? Ou talvez voc√™ esteja estudando DevOps e queira uma forma segura e replic√°vel de praticar provisionamento de servi√ßos? Este post √© para voc√™.
conto como construir um laborat√≥rio de estudos totalmente automatizado usando Vagrant e VirtualBox. O objetivo √© criar um ambiente limpo e isolado para aprivmorar, a pr√°tica sobre Infraestrutura como C√≥digo (IaC), automa√ß√£o com Bash Script e gerenciamento de servi√ßos com SystemD. Ao final, voc√™ ter√° uma inst√¢ncia do SonarQube pronta para uso, como se estivesse gerenciando uma VPS real.
As Ferramentas do Nosso Laborat√≥rio
SonarQube: √â a ferramenta l√≠der de mercado para an√°lise est√°tica de c√≥digo. Ele ajuda a identificar bugs, vulnerabilidades de seguran√ßa e "code smells", garantindo que a qualidade e a seguran√ßa do software sejam mantidas em alto n√≠vel. Ter um ambiente de testes √© fundamental para explorar suas integra√ß√µes com pipelines de CI/CD.
Vagrant: Permite criar e gerenciar m√°quinas virtuais (VMs) de forma simples e declarativa. Com um √∫nico comando, vagrant up, todo o ambiente √© provisionado. Isso garante reprodutibilidade, facilitando o compartilhamento com outros desenvolvedores e permitindo que voc√™ destrua e recrie o laborat√≥rio quantas vezes quiser.
Estrutura do Projeto
Nosso projeto ter√° tr√™s arquivos principais:
Vagrantfile: O "c√©rebro" do Vagrant. Define as configura√ß√µes da VM, como sistema operacional, rede, mem√≥ria e quais scripts de provisionamento executar.
provision.sh: O "bra√ßo" da automa√ß√£o. Um script shell que instala todas as depend√™ncias (como Java), baixa o SonarQube e o configura como um servi√ßo do sistema.
.env: Um arquivo de configura√ß√£o para armazenar vari√°veis, como vers√µes e URLs. Isso separa a configura√ß√£o da l√≥gica, facilitando atualiza√ß√µes futuras.
M√£o na Massa: Construindo o Laborat√≥rio
Pr√©-requisitos
Antes de come√ßar, certifique-se de ter o Vagrant e o VirtualBox instalados em sua m√°quina.
Instale o Vagrant: vagrantup.com/downloads
Instale o VirtualBox: virtualbox.org/wiki/Downloads
Iniciando o Projeto
Crie uma pasta para o projeto e, dentro dela, execute o comando para gerar um Vagrantfile inicial:
mkdir lab-sonarqube && cd lab-sonarqube
vagrant init
Enter fullscreen mode
Exit fullscreen mode
Configurando o Vagrantfile
Substitua o conte√∫do do Vagrantfile gerado como init pelo c√≥digo abaixo.
Vagrant.configure("2") do |config|
# Define o hostname da VM para f√°cil identifica√ß√£o
config.vm.hostname = "sonarqube-server"
# Define a imagem base da VM. Usaremos Ubuntu 22.04 LTS da Bento.
config.vm.box = "bento/ubuntu-22.04"
# Redireciona a porta 9000 da VM para a porta 9000 do seu computador.
# Isso permite acessar o SonarQube via http://localhost:9000
config.vm.network "forwarded_port", guest: 9000, host: 9000
# Sincroniza a pasta atual do projeto para /vagrant na VM
config.vm.synced_folder ".", "/vagrant", disabled: true
# Configura√ß√µes espec√≠ficas do provedor VirtualBox
config.vm.provider "virtualbox" do |vb|
# Aloca 2GB de RAM para a VM. SonarQube precisa de no m√≠nimo isso.
vb.memory = "2048"
# Define o n√∫mero de CPUs para a VM
vb.cpus = 2
end
# Copia o arquivo de vari√°veis para dentro da VM antes de provisionar
config.vm.provision "file", source: ".env", destination: "/home/vagrant/.env"
# Executa o script de provisionamento para instalar e configurar tudo
config.vm.provision "shell", path: "provision.sh"
end
Enter fullscreen mode
Exit fullscreen mode
Criando o Arquivo de Vari√°veis (.env)
Crie o arquivo .env na mesma pasta. Usar vari√°veis torna a manuten√ß√£o muito mais simples. Se o SonarQube lan√ßar uma nova vers√£o, basta atualizar este arquivo.
SONAR_USER=sonarqube
SONAR_GROUP=sonarqube
SONAR_VERSION=9.9.0.65466
SONAR_URL=https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-9.9.0.65466.zip
SONAR_ZIP=sonarqube-9.9.0.65466.zip
SONAR_HOME=/opt/sonarqube
JAVA_BIN=/usr/bin/java
SERVICE_FILE=/etc/systemd/system/sonarqube.service
Nota: SonarQube 9.9 LTS requer Java 17. A imagem bento/ubuntu-22.04 j√° vem com uma vers√£o compat√≠vel.
Enter fullscreen mode
Exit fullscreen mode
O Cora√ß√£o da Automa√ß√£o: O Script provision.sh
Este √© o script que faz a m√°gica acontecer. Crie o arquivo provision.sh:
#!/bin/bash
set -euo pipefail
set -a
source .env
set +a
main() {
if [[ $EUID -ne 0 ]]; then
echo "Run as root."
exit 1
fi
if ! getent group "$SONAR_GROUP" &>/dev/null; then
sudo groupadd "$SONAR_GROUP"
fi
if ! id -u "$SONAR_USER" &>/dev/null; then
sudo useradd --system --no-create-home -g "$SONAR_GROUP" "$SONAR_USER"
fi
sudo apt update
sudo apt install -y make wget unzip openjdk-17-jdk -y
# Instala SonarQube
wget -O "$SONAR_ZIP" "$SONAR_URL"
unzip -q "$SONAR_ZIP" -d /opt/
mv "/opt/sonarqube-${SONAR_VERSION}" "$SONAR_HOME"
rm "$SONAR_ZIP"
chown -R "$SONAR_USER:$SONAR_GROUP" "$SONAR_HOME"
touch "$SERVICE_FILE"
echo > "$SERVICE_FILE"
cat > "$SERVICE_FILE" <<EOT
[Unit]
Description=SonarQube service
After=syslog.target network.target
[Service]
Type=simple
User=$SONAR_USER
Group=$SONAR_GROUP
PermissionsStartOnly=true
ExecStart=$JAVA_BIN -Xms512m -Xmx512m -Djava.net.preferIPv4Stack=true -jar $SONAR_HOME/lib/sonar-application-25.8.0.112029.jar
StandardOutput=journal
LimitNOFILE=131072
LimitNPROC=8192
TimeoutStartSec=5
Restart=always
SuccessExitStatus=143
[Install]
WantedBy=multi-user.target
EOT
# Instala SonarScanner
wget -O "$SONAR_SCANNER_ZIP" "$SONAR_SCANNER_URL"
unzip -q "$SONAR_SCANNER_ZIP" -d /opt/
mv "/opt/sonar-scanner-${SONAR_SCANNER_VERSION}" "$SONAR_SCANNER_HOME"
rm "$SONAR_SCANNER_ZIP"
chown -R "$SONAR_USER:$SONAR_GROUP" "$SONAR_SCANNER_HOME"
echo 'export PATH=$PATH:/opt/sonar-scanner-cli/bin' | sudo tee -a /etc/profile
# Download and install n and Node.js:
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt install -y nodejs
# Verifica vers√£o do Node.js:
node -v # Deve mostrar "v22.18.0".
# Verifica vers√£o do npm:
npm -v # Deve mostrar "10.9.3".
systemctl daemon-reload
systemctl enable sonarqube
systemctl start sonarqube
sleep 10
systemctl status sonarqube --no-pager
if systemctl is-active --quiet sonarqube; then
echo "SonarQube iniciado com sucesso!"
exit 0
else
echo "Falha ao iniciar o SonarQube. Veja o status acima para detalhes."
exit 1
fi
}
main "$@"
Enter fullscreen mode
Exit fullscreen mode
Suba o Laborat√≥rio
Com todos os arquivos no lugar, execute o comando m√°gico:
vagrant up
Enter fullscreen mode
Exit fullscreen mode
O Vagrant ir√° baixar a imagem do Ubuntu, criar a VM, executar o script provision.sh e configurar tudo. Este processo pode levar alguns minutos na primeira vez.
Acesse o SonarQube
Ap√≥s o provisionamento, abra seu navegador e acesse http://localhost:9000. O SonarQube pode levar um ou dois minutos para iniciar completamente.
O login padr√£o √©:
Usu√°rio: admin
Senha: admin
Usando o SonarQube: Analisando seu Primeiro Projeto
Com o laborat√≥rio no ar, vamos fazer uma an√°lise de c√≥digo simples. Para isso, usaremos o sonar-scanner, uma ferramenta de linha de comando que envia o c√≥digo para o servidor SonarQube.
Crie um Projeto de Exemplo (na sua m√°quina local):
Vamos criar um arquivo Python com um "code smell" √≥bvio (uma vari√°vel n√£o utilizada).
# Crie uma pasta para o projeto de teste
mkdir projeto-exemplo && cd projeto-exemplo
# Crie um arquivo Python simples
cat > app.py <<EOF
import sys
def main():
message = "Ol√°, Mundo!" # Vari√°vel n√£o utilizada (code smell)
print("Executando o script...")
unused_variable = 123
return 0
if __name__ == "__main__":
sys.exit(main())
EOF
Enter fullscreen mode
Exit fullscreen mode
Gere um Token de Autentica√ß√£o no SonarQube:
Acesse http://localhost:9000.
V√° em My Account > Security.
Gere um novo token (ex: scanner-token) e copie o valor gerado.
Crie o Arquivo de Configura√ß√£o do Scanner:
Na pasta projeto-exemplo, crie o arquivo sonar-project.properties:
# Identificador √∫nico do projeto no SonarQube
sonar.projectKey=meu-primeiro-projeto
# Nome do projeto que aparecer√° na interface
sonar.projectName=Meu Primeiro Projeto Python
# Vers√£o do projeto
sonar.projectVersion=1.0
# Caminho para os arquivos de c√≥digo-fonte
sonar.sources=.
# Endere√ßo do seu servidor SonarQube
sonar.host.url=http://localhost:9000
# Token de autentica√ß√£o que voc√™ gerou
sonar.login=SEU_TOKEN_AQUI
Substitua SEU_TOKEN_AQUI pelo token que voc√™ copiou.
Enter fullscreen mode
Exit fullscreen mode
Execute a An√°lise:
Voc√™ precisar√° ter o sonar-scanner instalado localmente ou pode execut√°-lo via Docker. Usar Docker √© mais simples:
# Certifique-se de que o Docker est√° rodando
# Execute o scanner a partir da pasta do seu projeto
docker run \
--rm \
-e SONAR_HOST_URL="http://localhost:9000" \
-e SONAR_LOGIN="SEU_TOKEN_AQUI" \
-v "$(pwd):/usr/src" \
sonarsource/sonar-scanner-cli
Enter fullscreen mode
Exit fullscreen mode
Ap√≥s a execu√ß√£o, volte ao dashboard do SonarQube. Voc√™ ver√° seu "Meu Primeiro Projeto Python" listado, com um "code smell" identificado!
Aprendizados e Dicas
Infra como C√≥digo na Pr√°tica: Este laborat√≥rio √© um exemplo perfeito de IaC. O Vagrantfile e o provision.sh definem e automatizam toda a infraestrutura, garantindo consist√™ncia.
Debug de Provisionamento: Se algo der errado durante o vagrant up, use vagrant ssh para entrar na VM e verificar os logs (journalctl -u sonarqube.service) ou o status dos servi√ßos (systemctl status sonarqube.service).
Consumo de Recursos: O SonarQube consome bastante mem√≥ria RAM. Os 2GB definidos no Vagrantfile s√£o o m√≠nimo. Se a interface ficar lenta, considere aumentar a mem√≥ria para 4096.
Conclus√£o
Criar ambientes de teste automatizados √© uma habilidade essencial para qualquer pessoa que trabalhe com desenvolvimento, DevOps ou infraestrutura. Com Vagrant, voc√™ ganha um playground seguro para experimentar, aprender, errar e recome√ßar, sem impactar seu sistema principal. Agora voc√™ tem um ambiente SonarQube funcional para explorar a an√°lise de qualidade de c√≥digo e integr√°-la aos seus projetos.
Top comments (0)
Subscribe
Personal
Trusted User
Create template
Templates let you quickly answer FAQs or store snippets for re-use.
Submit
Preview
Dismiss
Code of Conduct
‚Ä¢
Report abuse
Are you sure you want to hide this comment? It will become hidden in your post, but will still be visible via the comment's permalink.
Hide child comments as well
Confirm
For further actions, you may consider blocking this person and/or reporting abuse
Marcos Vilela
Follow
üáßüá∑ Conte√∫do em portugu√™s!
üöÄ Platform Engineer com experi√™ncia em Linux, Docker e IaC (Ansible/Terraform), automa√ß√£o, observabilidade, Nginx, WordPress e bash scripts! üíª
SRE | DevOps
Location
Montes Claros, MG
Education
Unifavip - Wyden Educacional
Work
Analista Cloud
Joined
Oct 31, 2024
More from Marcos Vilela
Root Cause Analysis (RCA): entendendo a causa raiz de incidentes
#devops
#braziliandevs
#rca
#sre
Como constru√≠ um pipeline CI/CD com GitHub Actions, Docker e Terraform (e o que aprendi no caminho)
#braziliandevs
#docker
#terraform
#cicd
Atualizando do Debian 12 (Bookworm) para o Debian 13 (Trixie) de forma simples
#debian
#linux
#braziliandevs
#beginners
üíé DEV Diamond Sponsors
Thank you to our Diamond Sponsors for supporting the DEV Community
Google AI is the official AI Model and Platform Partner of DEV
Neon is the official database partner of DEV
Algolia is the official search partner of DEV
DEV Community ‚Äî A space to discuss and keep up software development and manage your software career
Home
DEV++
Welcome Thread
Reading List
Podcasts
Videos
Tags
DEV Education Tracks
DEV Challenges
DEV Help
Advertise on DEV
DEV Showcase
About
Contact
Free Postgres Database
Software comparisons
Forem Shop
Code of Conduct
Privacy Policy
Terms of Use
Built on Forem ‚Äî the open source software that powers DEV and other inclusive communities.
Made with love and Ruby on Rails. DEV Community ¬© 2016 - 2025.
We're a place where coders share, stay up-to-date and grow their careers.
Log in
Create account