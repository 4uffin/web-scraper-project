Resolving Missing Log Gaps in Data Guard - DEV Community
Forem Feed
Follow new Subforems to improve your feed
DEV Community
Follow
A space to discuss and keep up software development and manage your software career
Gamers Forem
Follow
An inclusive community for gaming enthusiasts
Future
Follow
News and discussion of science and technology such as AI, VR, cryptocurrency, quantum computing, and more.
Music Forem
Follow
From composing and gigging to gear, hot music takes, and everything in between.
DUMB DEV Community
Follow
Memes and software development shitposting
Vibe Coding Forem
Follow
Discussing AI software development, and showing off what we're building.
Popcorn Movies and TV
Follow
Movie and TV enthusiasm, criticism and everything in-between.
Design Community
Follow
Web design, graphic design and everything in-between
Maker Forem
Follow
A community for makers, hobbyists, and professionals to discuss Arduino, Raspberry Pi, 3D printing, and much more.
Scale Forem
Follow
For engineers building software at scale. We discuss architecture, cloud-native, and SREâ€”the hard-won lessons you can't just Google
Forem Core
Follow
Discussing the core forem open source software project â€” features, bugs, performance, self-hosting.
Security Forem
Follow
Your central hub for all things security. From ethical hacking and CTFs to GRC and career development, for beginners and pros alike
Crypto Forem
Follow
A collaborative community for all things Cryptoâ€”from Bitcoin to protocol development and DeFi to NFTs and market analysis.
Open Forem
Follow
A general discussion space for the Forem community. If it doesn't have a home elsewhere, it belongs here
Dropdown menu
Dropdown menu
Skip to content
Navigation menu
Search
Powered by Algolia
Search
Log in
Create account
DEV Community
Close
Add reaction
Like
Unicorn
Exploding Head
Raised Hands
Fire
Jump to Comments
Save
Boost
More...
Moderate
Copy link
Copy link
Copied to Clipboard
Share to X
Share to LinkedIn
Share to Facebook
Share to Mastodon
Report Abuse
Vahid Yousefzadeh
Posted on Sep 13
Resolving Missing Log Gaps in Data Guard
#oracle
#database
#linux
#rman
Fixing a standby gap has been possible since Oracle 10g using incremental backup, but it had to be done completely manually. This process required determining the SCN number, taking an incremental backup from the primary database, transferring the backup files to the standby server, and so on.
Starting from Oracle 12cR1, some improvements were introduced, and part of this process became automated. However, it still required going through several manual steps:
SQL>startup force mount
RMAN> RECOVER DATABASE FROM SERVICE prim NOREDO ;
RMAN> RESTORE STANDBY CONTROLFILE FROM SERVICE prim;
SQL>startup force;
ALTER DATABASE RECOVER MANAGED STANDBY DATABASE;
Enter fullscreen mode
Exit fullscreen mode
In Oracle 18c, further improvements were made. Now, with just one command, all the above steps are performed automatically:
RMAN> RECOVER STANDBY DATABASE FROM SERVICE tns_fal_server;
Enter fullscreen mode
Exit fullscreen mode
Below, we will simulate this scenario.
Step 1: Checking the current status of standby vs. primary
On primary (prim):
SQL> select max(sequence#),thread# from v$archived_log group by thread#;
MAX(SEQUENCE#)
THREAD#
â€”â€”â€”â€”â€“ â€”â€”â€”-
128
1
Enter fullscreen mode
Exit fullscreen mode
On standby (stb):
SQL> select max(sequence#),thread#,applied from gv$archived_log group by thread#,applied order by thread#;
MAX(SEQUENCE#)
THREAD# APPLIED
â€”â€”â€”â€”â€“ â€”â€”â€”- â€”â€”â€”
128
1 YES
Enter fullscreen mode
Exit fullscreen mode
As shown, the standby is in sync with the primary.
Step 2: Simulating a gap
We shut down the standby:
SQL> shutdown abort
ORACLE instance shut down.
Enter fullscreen mode
Exit fullscreen mode
Then, on the primary, we generate and immediately delete an archived log:
alter system switch logfile;
alter system switch logfile;
[oracle@hkm6 ~]$ rm -rf /18c/arch/1_129_972120046.dbf
Enter fullscreen mode
Exit fullscreen mode
When the standby is started again, it will wait for archive log 129, which was deleted:
SQL> startup
Database opened.
SQL> alter database recover managed standby database;
PR00 (PID:23943): Media Recovery Waiting for T-1.S-129
PR00 (PID:23943): Fetching gap from T-1.S-129 to T-1.S-129
Enter fullscreen mode
Exit fullscreen mode
At this stage, the standby is intentionally placed in a gap situation.
Step 3: Resolving the gap with Oracle 18c
Cancel managed recovery on standby:
SQL>
alter database recover managed standby database cancel;
Database altered.
Enter fullscreen mode
Exit fullscreen mode
2. Run the new Oracle 18c command in RMAN:
RMAN> recover standby database from service prim;
Starting recover at 26-APR-18
using target database control file instead of recovery catalog
Oracle instance started
Total System Global Area
4982831184 bytes
Fixed Size
8906832 bytes
Variable Size
1174405120 bytes
Database Buffers
3791650816 bytes
Redo Buffers
7868416 bytes
contents of Memory Script:
{
restore standby controlfile from service
â€˜primâ€™;
alter database mount standby database;
}
executing Memory Script
Starting restore at 26-APR-18
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=743 device type=DISK
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: using network backup set from service prim
channel ORA_DISK_1: restoring control file
channel ORA_DISK_1: restore complete, elapsed time: 00:00:01
output file name=/18c/base/oradata/USEFDB18/controlfile/control01.ctl
Finished restore at 26-APR-18
released channel: ORA_DISK_1
Statement processed
contents of Memory Script:
{
recover database from service
â€˜primâ€™;
}
executing Memory Script
Starting recover at 26-APR-18
Starting implicit crosscheck backup at 26-APR-18
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=743 device type=DISK
Crosschecked 12 objects
Finished implicit crosscheck backup at 26-APR-18
Starting implicit crosscheck copy at 26-APR-18
using channel ORA_DISK_1
Crosschecked 2 objects
Finished implicit crosscheck copy at 26-APR-18
searching for all files in the recovery area
cataloging filesâ€¦
no files cataloged
using channel ORA_DISK_1
skipping datafile 5; already restored to SCN 1506388
skipping datafile 6; already restored to SCN 1506388
skipping datafile 8; already restored to SCN 1506388
skipping datafile 57; already restored to SCN 6799373
skipping datafile 58; already restored to SCN 6799373
skipping datafile 59; already restored to SCN 6799373
channel ORA_DISK_1: starting incremental datafile backup set restore
channel ORA_DISK_1: using network backup set from service prim
destination for restore of datafile 00001: /18c/base/oradata/USEFDB18/datafile/o1_mf_system_fcvjfc9s_.dbf
channel ORA_DISK_1: restore complete, elapsed time: 00:00:15
channel ORA_DISK_1: starting incremental datafile backup set restore
channel ORA_DISK_1: using network backup set from service prim
destination for restore of datafile 00003: /18c/base/oradata/USEFDB18/datafile/o1_mf_sysaux_fcvjh2k2_.dbf
channel ORA_DISK_1: restore complete, elapsed time: 00:00:16
channel ORA_DISK_1: starting incremental datafile backup set restore
channel ORA_DISK_1: using network backup set from service prim
destination for restore of datafile 00004: /18c/base/oradata/USEFDB18/datafile/o1_mf_undotbs1_fcvjhvp9_.dbf
channel ORA_DISK_1: restore complete, elapsed time: 00:00:01
channel ORA_DISK_1: starting incremental datafile backup set restore
channel ORA_DISK_1: using network backup set from service prim
destination for restore of datafile 00007: /18c/base/oradata/USEFDB18/datafile/o1_mf_users_fcvjhwty_.dbf
channel ORA_DISK_1: restore complete, elapsed time: 00:00:01
starting media recovery
media recovery complete, elapsed time: 00:00:00
Finished recover at 26-APR-18
Finished recover at 26-APR-18
RMAN>
Enter fullscreen mode
Exit fullscreen mode
3. Restart managed recovery:
SQL>
alter database recover managed standby database;
PR00 (PID:25374): Media Recovery Waiting for T-1.S-131 (in transit)
Enter fullscreen mode
Exit fullscreen mode
Step 4: Verifying the result
Now, the standby has applied archive log 130, proving the gap is resolved:
SQL> select max(sequence#),thread#,applied from gv$archived_log where RESETLOGS_ID=972120046 group by thread#,applied order by thread#;
MAX(SEQUENCE#)
THREAD# APPLIED
â€”â€”â€”â€”â€“ â€”â€”â€”- â€”â€”â€”
130
1 YES
Enter fullscreen mode
Exit fullscreen mode
Top comments (0)
Subscribe
Personal
Trusted User
Create template
Templates let you quickly answer FAQs or store snippets for re-use.
Submit
Preview
Dismiss
Code of Conduct
â€¢
Report abuse
Are you sure you want to hide this comment? It will become hidden in your post, but will still be visible via the comment's permalink.
Hide child comments as well
Confirm
For further actions, you may consider blocking this person and/or reporting abuse
Vahid Yousefzadeh
Follow
I have been a DBA since 2011 and I work with Oracle technology...
Joined
Mar 7, 2025
More from Vahid Yousefzadeh
Hybrid Partition Table in OracleÂ 19c
#oracle
#devops
#linux
#database
Reducing Unified Audit Trail Size in Oracle 23ai
#oracle
#dba
#database
#linux
DataPump : Disabling the Use of Symbolic Links When Creating a Directory
#oracle
#database
#sql
#linux
ðŸ’Ž DEV Diamond Sponsors
Thank you to our Diamond Sponsors for supporting the DEV Community
Google AI is the official AI Model and Platform Partner of DEV
Neon is the official database partner of DEV
Algolia is the official search partner of DEV
DEV Community â€” A space to discuss and keep up software development and manage your software career
Home
Tags
About
Contact
Code of Conduct
Privacy Policy
Terms of Use
Built on Forem â€” the open source software that powers DEV and other inclusive communities.
Made with love and Ruby on Rails. DEV Community Â© 2016 - 2025.
We're a place where coders share, stay up-to-date and grow their careers.
Log in
Create account